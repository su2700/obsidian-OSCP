
```
Usage: ./exploit-2 SUID
```

```
find / -perm -4000 -type f 2>/dev/null

```
# **SUID 是什么？（一句话）**

**SUID = 一个普通用户执行某个程序时，会临时获得该程序文件所有者的权限（通常是 root）。**

list SUID

找到你可以利用的 SUID 文件，比如：

- `/usr/bin/passwd`
    
- `/usr/bin/su`
    
- `/usr/bin/chsh`
    
- `/usr/bin/sudo`
    
- 某些 lab 会有自定义的 SUID binary，例如 `/usr/local/bin/suid-helper`
    

---

# 🧪 第三步：用一个真实路径测试 exploit

例如：

`./exploit-2 /usr/bin/passwd`

或者：

`./exploit-2 /usr/bin/sudo`

如果这是一个针对 _任意 writable SUID 劫持_ 的 PoC，可能成功。

---

# 🧯 90% 新手错误：误以为参数是用户，而不是文件！

你做的是：

`./exploit-2 root`

系统会尝试打开：

`open("root", ...)`

但当前目录没有这个文件，所以报：

`open failed: No such file or directory`
# ✅ 利用结果分析

你运行：

`./exploit-2 /usr/bin/passwd ./exploit-2 /usr/bin/sudo`

每次都成功拿到 root shell：

`[+] hijacking suid binary.. [+] dropping suid shell.. [+] restoring suid binary.. [+] popping root shell.. #`

这说明 **exploit-2 是一个 SUID 劫持（SUID hijacking）漏洞利用工具**。

---

# 🧠 Exploit 过程逐步解释

### **1. hijacking suid binary（劫持 SUID 程序）**

SUID 程序是：

- 由 root 拥有
    
- 但是普通用户执行时会以 root 权限运行
    

例如：

`-rwsr-xr-x 1 root root ... /usr/bin/passwd -rwsr-xr-x 1 root root ... /usr/bin/sudo`

exploit 做的第一件事是：

✔️ 备份原本的 SUID 程序  
✔️ 把它覆盖成自己的恶意代码  
（该恶意代码由你执行时运行，进而触发 root ）

---

### **2. dropping suid shell（放置一个 SUID shell）**

exploit 会创建一个 **root 权限的 shell**，通常在：

`/tmp/sh`

并设置 SUID 位：

`chmod 4755 /tmp/sh`

❤️ 这一步是关键：  
即使之后恢复原始 SUID 程序，你的 `/tmp/sh` 仍然是 **可随时获得 root 的入口**。

---

### **3. restoring suid binary（恢复原来的 SUID 程序）**

为了不留痕迹、避免管理员发现，exploit 会：

✔️ 把覆盖掉的 `/usr/bin/passwd`（或 sudo）恢复成原来的副本  
✔️ 不破坏系统正常功能

这个动作让利用看起来更“干净”。

---

### **4. popping root shell（弹出 root shell）**

最后 exploit 执行 `/tmp/sh`，于是你进入 root：

`#`

完成提权。

---

# 🧯 很重要：利用完成后记得清理 `/tmp/sh`

exploit 也提醒你：

`dont forget to clean up /tmp/sh ;)`

如果你不删掉：

`rm /tmp/sh`

系统就一直存在一个 root 后门。